{"version":3,"sources":["../../../client/components/auth/auth.service.js"],"names":[],"mappings":"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","file":"auth.service.js","sourcesContent":["'use strict';\n\nangular.module('meanshopApp')\n  .factory('Auth', function Auth($http, User, $cookies, $q) {\n    /**\n     * Return a callback or noop function\n     *\n     * @param  {Function|*} cb - a 'potential' function\n     * @return {Function}\n     */\n    var safeCb = function(cb) {\n      return (angular.isFunction(cb)) ? cb : angular.noop;\n    },\n\n    currentUser = {};\n\n    if ($cookies.get('token')) {\n      currentUser = User.get();\n    }\n\n    return {\n\n      /**\n       * Authenticate user and save token\n       *\n       * @param  {Object}   user     - login info\n       * @param  {Function} callback - optional, function(error, user)\n       * @return {Promise}\n       */\n      login: function(user, callback) {\n        return $http.post('/auth/local', {\n          email: user.email,\n          password: user.password\n        })\n        .then(function(res) {\n          $cookies.put('token', res.data.token);\n          currentUser = User.get();\n          return currentUser.$promise;\n        })\n        .then(function(user) {\n          safeCb(callback)(null, user);\n          return user;\n        })\n        .catch(function(err) {\n          this.logout();\n          safeCb(callback)(err.data);\n          return $q.reject(err.data);\n        }.bind(this));\n      },\n\n      /**\n       * Delete access token and user info\n       */\n      logout: function() {\n        $cookies.remove('token');\n        currentUser = {};\n      },\n\n      /**\n       * Create a new user\n       *\n       * @param  {Object}   user     - user info\n       * @param  {Function} callback - optional, function(error, user)\n       * @return {Promise}\n       */\n      createUser: function(user, callback) {\n        return User.save(user,\n          function(data) {\n            $cookies.put('token', data.token);\n            currentUser = User.get();\n            return safeCb(callback)(null, user);\n          },\n          function(err) {\n            this.logout();\n            return safeCb(callback)(err);\n          }.bind(this)).$promise;\n      },\n\n      /**\n       * Change password\n       *\n       * @param  {String}   oldPassword\n       * @param  {String}   newPassword\n       * @param  {Function} callback    - optional, function(error, user)\n       * @return {Promise}\n       */\n      changePassword: function(oldPassword, newPassword, callback) {\n        return User.changePassword({ id: currentUser._id }, {\n          oldPassword: oldPassword,\n          newPassword: newPassword\n        }, function() {\n          return safeCb(callback)(null);\n        }, function(err) {\n          return safeCb(callback)(err);\n        }).$promise;\n      },\n\n      /**\n       * Gets all available info on a user\n       *   (synchronous|asynchronous)\n       *\n       * @param  {Function|*} callback - optional, funciton(user)\n       * @return {Object|Promise}\n       */\n      getCurrentUser: function(callback) {\n        if (arguments.length === 0) {\n          return currentUser;\n        }\n\n        var value = (currentUser.hasOwnProperty('$promise')) ? currentUser.$promise : currentUser;\n        return $q.when(value)\n          .then(function(user) {\n            safeCb(callback)(user);\n            return user;\n          }, function() {\n            safeCb(callback)({});\n            return {};\n          });\n      },\n\n      /**\n       * Check if a user is logged in\n       *   (synchronous|asynchronous)\n       *\n       * @param  {Function|*} callback - optional, function(is)\n       * @return {Bool|Promise}\n       */\n      isLoggedIn: function(callback) {\n        if (arguments.length === 0) {\n          return currentUser.hasOwnProperty('role');\n        }\n\n        return this.getCurrentUser(null)\n          .then(function(user) {\n            var is = user.hasOwnProperty('role');\n            safeCb(callback)(is);\n            return is;\n          });\n      },\n\n       /**\n        * Check if a user is an admin\n        *   (synchronous|asynchronous)\n        *\n        * @param  {Function|*} callback - optional, function(is)\n        * @return {Bool|Promise}\n        */\n      isAdmin: function(callback) {\n        if (arguments.length === 0) {\n          return currentUser.role === 'admin';\n        }\n\n        return this.getCurrentUser(null)\n          .then(function(user) {\n            var is = user.role === 'admin';\n            safeCb(callback)(is);\n            return is;\n          });\n      },\n\n      /**\n       * Get auth token\n       *\n       * @return {String} - a token string used for authenticating\n       */\n      getToken: function() {\n        return $cookies.get('token');\n      }\n    };\n  });\n"]}